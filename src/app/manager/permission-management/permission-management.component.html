<div class="content-box permission-management">
  <div class="permission-management-title">
    <h4>
      {{language.currentLanguage.permissionTitle}}
    </h4>
  </div>
  <div class="permission-management-content">
    <div class="select-account">
      <div>
        <input (keyup)="searchUsernameByKeyword()" [(ngModel)]="searchKeyword" [disabled]="isLoading" type="text"
          class="form-control" [placeholder]="language.currentLanguage.permissionSearchHint" name="searchKeyword">
      </div>
      <app-loading *ngIf="isLoading"></app-loading>
      <div *ngIf="!isLoading" class="list-account">
        <div *ngFor="let user of listUserDisplay" (click)="seeAccountInfomation(user.username)">
          {{user.username}}
        </div>
      </div>
    </div>
    <div class="account-control">
      <div class="account-info" *ngIf="currentAccount !== undefined">
        <img [src]="this.currentAccount.avatar">
        <h4>{{currentAccount.username}}</h4>
        <span>{{currentAccount.email}}</span>
        <span>{{currentAccount.lastName + ' ' + currentAccount.firstName}}</span>
        <span>{{currentAccount.permission}}</span>
        <div class="setting-for-account">
          <input type="button" class="btn btn-success" (click)="openConfirmDialog(updatePermission, 'change')"
            [value]="language.currentLanguage.permissionUpdatePermission" [disabled]="isWaitingUpdate">
          <input type="button" class="btn btn-danger" [value]="language.currentLanguage.permissionBlock" 
            [disabled]="isWaitingUpdate">
          <app-loading *ngIf="isWaitingUpdate"></app-loading>
        </div>
        <div [ngClass]="{'mess': true, 'mess-err': hasError}" *ngIf="message !== ''">
          {{message}}
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #updatePermission let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">{{language.currentLanguage.permissionConfirmTitle}}</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body form-group">
    <div class="form-group">
      <label>{{language.currentLanguage.permissionTypeConfirmPassword}}</label>
      <input type="password" class="form-control" [(ngModel)]="confirmPassword">
    </div>
    <div>
      <label>{{language.currentLanguage.permissionChoosePermission}}</label>
      <div class="form-check" *ngFor="let permission of listPermission">
        <input class="form-check-input" type="checkbox" value="" [checked]="permission.isChecked" 
          (change)="permission.isChecked = !permission.isChecked">
        <label class="form-check-label" for="defaultCheck1">
          {{permission.permissionName}}
        </label>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger"
      (click)="modal.close()">{{language.currentLanguage.permissionConfirmCancel}}</button>
    <button type="button" class="btn btn-success"
      (click)="updateCurrrentAccountPermission()" [disabled]="confirmPassword === undefined || confirmPassword === ''">
        {{language.currentLanguage.permissionConfirmOk}}
      </button>
  </div>
</ng-template>