<div class="border-box tour-containner">
  <form class="flex-1">
    <div class="stepper" *ngIf="stepperService.getStep() === 1">
      <h3 class="page-title">{{compLanguage.addTourInfoTitle}}</h3>
      <div class="form-group flex-row">
        <label class="row-label">{{compLanguage.addTourName}}</label>
        <div class="row-input">
          <input [(ngModel)]="tourModel.tourName" name="tour-name" type="text" class="form-control"
            [placeholder]="compLanguage.addTourEnterName">
        </div>
      </div>
      <div class="form-group flex-row">
        <label class="row-label">{{compLanguage.addTourDesc}}</label>
        <div class="row-input">
          <textarea rows="3" class="form-control" [(ngModel)]="tourModel.description" name="tour-description"
            style="resize:none" [placeholder]="compLanguage.addTourEnterDesc"></textarea>
        </div>
      </div>
      <div class="form-group flex-row">
        <label class="row-label">{{compLanguage.addTourCover}}</label>
        <div class="row-input flex-row flex-justify-end">
          <input type="button" [value]="commonLanguage.enter + compLanguage.addTourCover"
            class="btn btn-warning" style="width: fit-content;" (click)="inputFile.click()"
            *ngIf="tourModel.cover === ''">
          <input type="file" #inputFile style="display: none;" (change)="onImagePicked($event)">
          <div class="flex-1 img-layout" *ngIf="tourModel.cover.length > 0">
            <img [src]="tourModel.cover" alt="review">
            <span class="fas fa-times-circle esc-btn" (click)="removeCover()"></span>
          </div>
        </div>
      </div>
      <div class="form-group flex-row">
        <label class="row-label">{{compLanguage.addTourBeginTime}}</label>
        <div class="row-input flex-row">
          <div class="flex-1 flex-items-center">
            <div class="input-group">
              <input class="form-control" placeholder="yyyy-mm-dd" name="startDate" [(ngModel)]="startDate"
                [minDate]="today" (ngModelChange)="validateStartEndDate()" ngbDatepicker #startdate="ngbDatepicker"
                #modalstartdate="ngModel" readonly>
              <div class="input-group-append">
                <button class="btn btn-outline-secondary calendar" (click)="startdate.toggle()" type="button">
                  <span><i class="fas fa-calendar-alt"></i></span>
                </button>
              </div>
            </div>
          </div>
          <div class="flex-1 flex-row flex-items-center">
            <ngb-timepicker name="startTime" [(ngModel)]="startTime"></ngb-timepicker>
          </div>
        </div>
      </div>
      <div class="form-group flex-row">
        <label class="row-label">{{compLanguage.addTourEndTime}}</label>
        <div class="row-input flex-row">
          <div class="flex-1 flex-items-center">
            <div class="input-group">
              <input class="form-control" placeholder="yyyy-mm-dd" name="endDate" [(ngModel)]="endDate" ngbDatepicker
                [minDate]="startDate" #enddate="ngbDatepicker" #modalenddate="ngModel" readonly>
              <div class="input-group-append">
                <button class="btn btn-outline-secondary calendar" (click)="enddate.toggle()" type="button">
                  <span><i class="fas fa-calendar-alt"></i></span>
                </button>
              </div>
            </div>
          </div>
          <div class="flex-1 flex-row flex-items-center">
            <ngb-timepicker name="endTime" [(ngModel)]="endTime"></ngb-timepicker>
          </div>
        </div>
      </div>
      <div class="form-group flex-row">
        <label class="row-label">{{compLanguage.addTourEndFeedbackTime}}</label>
        <div class="row-input flex-row">
          <div class="flex-1 flex-items-center">
            <div class="input-group">
              <input class="form-control" placeholder="yyyy-mm-dd" name="deadline" [(ngModel)]="feedbackDeadline"
                readonly ngbDatepicker [maxDate]="startDate" #feedbackdeadline="ngbDatepicker"
                #modalfeedbackDeadline="ngModel">
              <div class="input-group-append">
                <button class="btn btn-outline-secondary calendar" (click)="feedbackdeadline.toggle()" type="button">
                  <span><i class="fas fa-calendar-alt"></i></span>
                </button>
              </div>
            </div>
          </div>
          <div class="flex-1 flex-row flex-items-center">
            <ngb-timepicker name="feedbackTime" [(ngModel)]="feedbackTime"></ngb-timepicker>
          </div>
        </div>
      </div>
      <div class="form-group flex-row">
        <label class="row-label">{{compLanguage.addTourEndRegisterTime}}</label>
        <div class="row-input flex-row">
          <div class="flex-1 flex-items-center">
            <div class="input-group">
              <input class="form-control" placeholder="yyyy-mm-dd" name="register-deadline" readonly
                [(ngModel)]="registerDeadline" ngbDatepicker [maxDate]="startDate" #registerdeadline="ngbDatepicker"
                #modalregisterdeadline="ngModel">
              <div class="input-group-append">
                <button class="btn btn-outline-secondary calendar" (click)="registerdeadline.toggle()" type="button">
                  <span><i class="fas fa-calendar-alt"></i></span>
                </button>
              </div>
            </div>
          </div>
          <div class="flex-1 flex-row flex-items-center">
            <ngb-timepicker name="registerTime" [(ngModel)]="registerTime"></ngb-timepicker>
          </div>
        </div>
      </div>
      <div class="form-group flex-row">
        <label class="row-label">{{compLanguage.addTourProvince}}</label>
        <div class="row-input select-field">
          <select class="form-control flex-1" multiple>
            <option *ngFor="let province of arrProvince" (click)="selectProvince(province)">
              {{province.provinceName}}
            </option>
          </select>
          <div class="selected-field flex-1">
            <div class="tag" *ngFor="let province of arrSelectedProvince" (click)="removeProvince(province)">
              {{province.provinceName}}
              <span _ngcontent-c11="" class="fas fa-times-circle esc-btn"></span>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group flex-row">
        <label class="row-label">{{compLanguage.addTourLocation}}</label>
        <div class="row-input flex-col">
          <div class="flex-row" style="margin-bottom: 3px;">
            <div class="flex-1">
              <input type="text" [placeholder]="compLanguage.addTourEnterLocation" class="form-control"
                name="location-name" [(ngModel)]="searchLocationName">
            </div>
            <div class="flex-1">
              <input type="button" class="form-control btn-warning" style="margin-left: 6px; width: 97%;"
                [value]="compLanguage.addTourNewLocation" (click)="openNewLocationDialog(addlocation)">
            </div>
          </div>
          <div class="flex-row select-field">
            <select class="form-control flex-1" multiple>
              <option *ngFor="let location of arrLocations" (click)="selectItem(arrSelectedLocation, location)">
                {{location.locationName}}
              </option>
            </select>
            <div class="selected-field flex-1">
              <div class="tag" *ngFor="let location of arrSelectedLocation"
                (click)="removeItem(arrSelectedLocation, location)">
                {{location.locationName}}
                <span _ngcontent-c11="" class="fas fa-times-circle esc-btn"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="form-group flex-row">
        <label class="row-label">
          {{compLanguage.addSchedulePerform}}
        </label>
        <div class="row-input flex-col">
          <div class="row-input select-field">
            <select class="form-control flex-1" multiple>
              <option *ngFor="let tourguide of arrTourguides" (click)="selectItem(arrSelectedTourguide, tourguide)">
                {{tourguide.displayName}} ({{tourguide.username}})
              </option>
            </select>
            <div class="selected-field flex-1">
              <div class="tag" *ngFor="let tourguide of arrSelectedTourguide"
                (click)="removeItem(arrSelectedTourguide, tourguide)">
                {{tourguide.displayName}}
                <span _ngcontent-c11="" class="fas fa-times-circle esc-btn"></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="stepper" *ngIf="stepperService.getStep() === 2">
      <h3 class="page-title">{{compLanguage.addTourSchedulesTitle}}</h3>
      <div class="flex-row">
        <h4>{{compLanguage.addTourAddSchedule}} {{commonLanguage.from}}
          {{startDate.day}}/{{startDate.month}} {{commonLanguage.to}} {{endDate.day}}/{{endDate.month}}</h4>
      </div>
      <div class="form-group flex-row">
        <app-add-schedule *ngFor="let schedule of tourModel.schedules; let i = index" [scheduleModel]="schedule"
          [index]="i"></app-add-schedule>
      </div>
      <div class="flex-row flex-justify-space-between flex-align-center">
        <h4>
          {{compLanguage.addTourScheduleCost}}
        </h4>
        <input type="button" (click)="addShedule()" [value]="compLanguage.addTourAddSchedule"
          class="btn btn-warning" style="width: fit-content;">
      </div>
    </div>
    <div class="stepper" *ngIf="stepperService.getStep() === 3">
      <h3 class="page-title">{{compLanguage.addTourPreparationTitle}}</h3>
      <div class="form-group flex-row">
        <label class="row-label">
          {{compLanguage.addTourTourguide}}
        </label>
        <div class="row-input">
          <select class="form-control">
            <option *ngFor="let tourguide of arrSelectedTourguide" [value]="tourguide._id">
              {{tourguide.displayName}} ({{tourguide.username}})
            </option>
          </select>
        </div>
      </div>
      <div class="form-group flex-row">
        <label class="row-label">
          {{compLanguage.addTourContact}}
        </label>
        <div class="row-input">
          <input type="text" class="form-control">
        </div>
      </div>
      <div class="form-group flex-row">
        <label class="row-label">
          {{compLanguage.addTourLimitMembers}}
        </label>
        <div class="row-input input-group">
          <input type="number" class="form-control">
          <div class="input-group-append">
            <span class="input-group-text">{{compLanguage.addTourPeople}}</span>
          </div>
        </div>
      </div>
      <div class="form-group flex-row">
        <label class="row-label">
          {{compLanguage.addTourRegisterCost}}
        </label>
        <div class="row-input input-group">
          <input type="number" class="form-control" name="cost">
          <div class="input-group-append">
            <span class="input-group-text">.VND</span>
          </div>
        </div>
      </div>
      <div class="flex-row">
        <label class="row-label">
          {{compLanguage.addTourItemPreparation}}
        </label>
        <div class="row-input"></div>
      </div>
      <div class="flex-col form-group">
        <app-add-preparation></app-add-preparation>
      </div>
      <div class="flex-row flex-justify-end">
        <input type="button" [value]="compLanguage.addTourAddPrepataion" class="btn btn-warning"
          style="width: fit-content;">
      </div>
    </div>
  </form>
  <div *ngIf="errorMess !== ''" class="alert alert-danger" style="margin-top: 5px">
    {{errorMess}}
  </div>
  <div class="steps-control">
    <input type="button" [value]="commonLanguage.prev" class="btn btn-outline-success"
      (click)="stepperService.toPrev()" [disabled]="stepperService.getStep() === 1">
    <input type="button" [value]="commonLanguage.next" class="btn btn-outline-success"
      (click)="validatePage()" [disabled]="stepperService.getStep() === stepperService.getMaxStep()">
  </div>
</div>
<div class="border-box tourguide-container">
</div>

<ng-template #addlocation let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">{{compLanguage.addTourNewLocation}}</h4>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form *ngIf="!isLoading" [formGroup]="addLocationForm">
      <div class="form-group">
        <label>{{compLanguage.addTourLocationName}}</label>
        <input type="text" class="form-control" formControlName="locationName"
          [placeholder]="commonLanguage.enter + compLanguage.addTourLocationName">
        <span
          *ngIf="!addLocationForm.get('locationName').valid && (addLocationForm.get('locationName').dirty || addLocationForm.get('locationName').touched)"
          class="error-mess form-text text-muted">
          {{commonLanguage.thisFieldIsRequired}}
        </span>
      </div>
      <div class="form-group">
        <label>{{compLanguage.addTourLocationProvince}}</label>
        <select class="form-control" multiple formControlName="provinceCity">
          <option *ngFor="let province of arrProvince">
            {{province.provinceName}}
          </option>
        </select>
        <span
          *ngIf="!addLocationForm.get('provinceCity').valid && (addLocationForm.get('provinceCity').dirty || addLocationForm.get('provinceCity').touched)"
          class="error-mess form-text text-muted">
          {{commonLanguage.thisFieldIsRequired}}
        </span>
        <small>{{compLanguage.addTourNoteSelectMore}}</small>
      </div>
      <div class="form-group">
        <label>{{compLanguage.addTourLocationGPS}}</label>
        <input type="text" class="form-control" formControlName="gps"
          [placeholder]="commonLanguage.enter + compLanguage.addTourLocationGPS">
      </div>
      <div class="form-group">
        <label>{{compLanguage.addTourLocationAddress}}</label>
        <input type="text" class="form-control" formControlName="address"
          [placeholder]="commonLanguage.enter + compLanguage.addTourLocationAddress">
        <span
          *ngIf="!addLocationForm.get('address').valid && (addLocationForm.get('address').dirty || addLocationForm.get('address').touched)"
          class="error-mess form-text text-muted">
          {{commonLanguage.thisFieldIsRequired}}
        </span>
      </div>
    </form>
    <div class="alert" *ngIf="addLocationMessage !== ''"
      [ngClass]="{'alert-success': !hasError, 'alert-danger': hasError}">
      {{addLocationMessage}}
    </div>
    <app-loading *ngIf="isLoading"></app-loading>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-danger" (click)="modal.close()">{{commonLanguage.cancel}}</button>
    <button type="button" class="btn btn-success" [disabled]="!addLocationForm.valid" (click)="addLocation()">
      {{commonLanguage.ok}}
    </button>
  </div>
</ng-template>